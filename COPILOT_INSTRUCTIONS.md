# GitHub Copilot Instructions ‚Äî Back-end (Phase 0)

**–ü—Ä–æ–µ–∫—Ç:** GoGoMarket.uz ‚Äî Social Video Marketplace  
**–î–∞—Ç–∞:** –Ø–Ω–≤–∞—Ä—å 2026  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** Back-end —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞  
**–§–∞–∑–∞:** 0 ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ë–õ–û–ö–ï–†–´)

---

## üéØ –¶–µ–ª—å –§–∞–∑—ã 0

–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ backend, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 5-6 –¥–Ω–µ–π  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–ë–õ–û–ö–ï–†–´)

---

## üìã –ó–∞–¥–∞—á–∏ Back-end (B0.1 ‚Äî B0.7)

### B0.1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–§–∞–π–ª:** `backend/src/app.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**  
CORS –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ª—é–±–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`origin: '*'`), —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è CSRF –∞—Ç–∞–∫.

**–ó–∞–¥–∞—á–∞:**
1. –ó–∞–º–µ–Ω–∏—Ç—å `origin: '*'` –Ω–∞ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.example`:
   ```
   CORS_ORIGIN=https://gogomarket.uz,https://admin.gogomarket.uz,https://seller.gogomarket.uz
   ```
3. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CORS –≤ `app.ts`:
   ```typescript
   app.use(cors({
     origin: process.env.CORS_ORIGIN?.split(',') || ['https://localhost:3000'],
     credentials: true,
     methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
     allowedHeaders: ['Content-Type', 'Authorization']
   }));
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ó–∞–ø—Ä–æ—Å—ã –æ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- –ó–∞–ø—Ä–æ—Å—ã –æ—Ç –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

---

### B0.2: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (MIME-type)
**–°—Ä–æ–∫:** 1.5 –¥–Ω—è  
**–§–∞–π–ª:** `backend/src/services/uploadService.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã.

**–ó–∞–¥–∞—á–∞:**
1. –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ MIME-type
2. –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: `image/jpeg`, `image/png`, `image/webp`, `image/gif`
   - –í–∏–¥–µ–æ: `video/mp4`, `video/quicktime`, `video/x-msvideo`
3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –Ω–æ –∏ —Ä–µ–∞–ª—å–Ω—ã–π MIME-type —Ñ–∞–π–ª–∞ (magic numbers)
4. –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: –º–∞–∫—Å–∏–º—É–º 5 –ú–ë
   - –í–∏–¥–µ–æ: –º–∞–∫—Å–∏–º—É–º 100 –ú–ë
5. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:
   ```typescript
   import fileType from 'file-type';
   
   const ALLOWED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
   const ALLOWED_VIDEO_TYPES = ['video/mp4', 'video/quicktime'];
   const MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB
   const MAX_VIDEO_SIZE = 100 * 1024 * 1024; // 100MB
   
   async function validateFile(file: Buffer, expectedType: 'image' | 'video') {
     const type = await fileType.fromBuffer(file);
     
     if (!type) {
       throw new Error('Cannot determine file type');
     }
     
     const allowedTypes = expectedType === 'image' ? ALLOWED_IMAGE_TYPES : ALLOWED_VIDEO_TYPES;
     
     if (!allowedTypes.includes(type.mime)) {
       throw new Error(`File type ${type.mime} is not allowed`);
     }
     
     return true;
   }
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å `.exe`, `.sh`, `.js` —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### B0.3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Redis
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–§–∞–π–ª—ã:** –ù–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis:
   ```bash
   npm install redis ioredis
   npm install --save-dev @types/ioredis
   ```
2. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `backend/src/config/redis.ts`:
   ```typescript
   import Redis from 'ioredis';
   
   const redisClient = new Redis({
     host: process.env.REDIS_HOST || 'localhost',
     port: parseInt(process.env.REDIS_PORT || '6379'),
     password: process.env.REDIS_PASSWORD,
     db: parseInt(process.env.REDIS_DB || '0'),
     retryStrategy(times) {
       // Exponential backoff: starts at 50ms, increases by 50ms per attempt, max 2000ms (2s)
       const delay = Math.min(times * 50, 2000);
       return delay;
     },
   });
   
   redisClient.on('error', (err) => {
     console.error('Redis Client Error:', err);
   });
   
   redisClient.on('connect', () => {
     console.log('‚úÖ Redis connected');
   });
   
   export default redisClient;
   ```
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.example`:
   ```
   REDIS_HOST=localhost
   REDIS_PORT=6379
   REDIS_PASSWORD=
   REDIS_DB=0
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Redis –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "‚úÖ Redis connected"

---

### B0.4: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ OTP —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ Redis
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–§–∞–π–ª:** `backend/src/controllers/authController.ts`  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** B0.3

**–ü—Ä–æ–±–ª–µ–º–∞:**  
OTP –∫–æ–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ Node.js –ø—Ä–æ—Ü–µ—Å—Å–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–ó–∞–¥–∞—á–∞:**
1. –£–±—Ä–∞—Ç—å in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ OTP –∏–∑ `authController.ts`
2. –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Redis —Å TTL (Time-To-Live):
   ```typescript
   import redisClient from '../config/redis';
   
   // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å OTP
   async function saveOTP(phone: string, otp: string) {
     const key = `otp:${phone}`;
     const ttl = 5 * 60; // 5 –º–∏–Ω—É—Ç
     await redisClient.setex(key, ttl, otp);
   }
   
   // –ü–æ–ª—É—á–∏—Ç—å OTP
   async function getOTP(phone: string): Promise<string | null> {
     const key = `otp:${phone}`;
     return await redisClient.get(key);
   }
   
   // –£–¥–∞–ª–∏—Ç—å OTP –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   async function deleteOTP(phone: string) {
     const key = `otp:${phone}`;
     await redisClient.del(key);
   }
   ```
3. OTP –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—Ç—å —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ OTP ‚Äî —É–¥–∞–ª—è—Ç—å –µ–≥–æ –∏–∑ Redis

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- OTP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis —Å TTL 5 –º–∏–Ω—É—Ç
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ OTP –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π OTP —É–¥–∞–ª—è–µ—Ç—Å—è

---

### B0.5: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏–π JWT —Å–µ–∫—Ä–µ—Ç
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–§–∞–π–ª:** `backend/.env`

**–ü—Ä–æ–±–ª–µ–º–∞:**  
JWT —Å–µ–∫—Ä–µ—Ç —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫–∏.

**–ó–∞–¥–∞—á–∞:**
1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏–π —Å–µ–∫—Ä–µ—Ç (256 –±–∏—Ç):
   ```bash
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```
2. –û–±–Ω–æ–≤–∏—Ç—å `.env`:
   ```
   JWT_SECRET=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex —Å—Ç—Ä–æ–∫–∞>
   JWT_EXPIRES_IN=7d
   JWT_REFRESH_SECRET=<–¥—Ä—É–≥–æ–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç>
   JWT_REFRESH_EXPIRES_IN=30d
   ```
3. –û–±–Ω–æ–≤–∏—Ç—å `.env.example` —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏:
   ```
   # JWT —Å–µ–∫—Ä–µ—Ç—ã (–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")
   JWT_SECRET=generate_your_own_256bit_secret_here
   JWT_EXPIRES_IN=7d
   JWT_REFRESH_SECRET=generate_different_256bit_secret_here
   JWT_REFRESH_EXPIRES_IN=30d
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- JWT —Å–µ–∫—Ä–µ—Ç –∏–º–µ–µ—Ç –¥–ª–∏–Ω—É 64 —Å–∏–º–≤–æ–ª–∞ (256 –±–∏—Ç)
- Refresh token –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç

---

### B0.6: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ hardcoded IP –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–§–∞–π–ª—ã:** `backend/src/config/api.ts`, `backend/src/services/uploadService.ts`, `backend/src/services/socketService.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**  
IP –∞–¥—Ä–µ—Å–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ (`64.226.94.133`), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–µ–≥–∏–±–∫–æ–π.

**–ó–∞–¥–∞—á–∞:**
1. –ù–∞–π—Ç–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `64.226.94.133` –≤ –∫–æ–¥–µ:
   ```bash
   grep -r "64.226.94.133" backend/src/
   ```
2. –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```typescript
   const API_BASE_URL = process.env.API_BASE_URL || 'https://localhost:3000';
   ```
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.example`:
   ```
   API_BASE_URL=https://api.gogomarket.uz
   FRONTEND_URL=https://gogomarket.uz
   ADMIN_URL=https://admin.gogomarket.uz
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ù–µ—Ç hardcoded IP –≤ –∫–æ–¥–µ
- –í—Å–µ URL –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

### B0.7: –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ë–î
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–§–∞–π–ª:** `backend/src/config/database.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**  
`rejectUnauthorized: false` –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è MITM –∞—Ç–∞–∫.

**–ó–∞–¥–∞—á–∞:**
1. –ù–∞–π—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PostgreSQL –≤ `database.ts`
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   ```typescript
   dialectOptions: {
     ssl: process.env.DB_SSL === 'true' ? {
       require: true,
       rejectUnauthorized: true, // –í–ê–ñ–ù–û: –Ω–µ false!
       ca: process.env.DB_SSL_CA // –ø—É—Ç—å –∫ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
     } : false
   }
   ```
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.example`:
   ```
   DB_SSL=true
   DB_SSL_CA= # –ü—É—Ç—å –∫ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–º SSL

---

## üìÇ –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –§–∞–π–ª | –ó–∞–¥–∞—á–∏ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|--------|-----------|
| `backend/src/app.ts` | B0.1 (CORS) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/src/services/uploadService.ts` | B0.2 (–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/src/config/redis.ts` | B0.3 (Redis) ‚Äî **—Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π** | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/src/controllers/authController.ts` | B0.4 (OTP –≤ Redis) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/.env` | B0.5 (JWT —Å–µ–∫—Ä–µ—Ç), B0.6 (IP ‚Üí env) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/.env.example` | –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/src/config/database.ts` | B0.7 (SSL –ë–î) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| `backend/package.json` | –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `ioredis`, `file-type` | üü† –í—ã—Å–æ–∫–∏–π |

---

## üîÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –≤–µ—Ç–∫–∞–º–∏

### –í–µ—Ç–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã
```bash
git checkout -b feature/backend-security-phase0
```

### –ö–æ–º–º–∏—Ç—ã
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤:

```bash
git commit -m "feat(security): configure CORS with domain whitelist (B0.1)"
git commit -m "feat(security): add file type validation with MIME check (B0.2)"
git commit -m "feat(redis): add Redis client configuration (B0.3)"
git commit -m "feat(auth): migrate OTP storage to Redis with TTL (B0.4)"
git commit -m "feat(security): generate cryptographically secure JWT secret (B0.5)"
git commit -m "refactor(config): move hardcoded IPs to environment variables (B0.6)"
git commit -m "fix(database): enable SSL certificate validation (B0.7)"
```

### Pull Request
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:
1. Push –≤–µ—Ç–∫–∏ –Ω–∞ GitHub
2. –°–æ–∑–¥–∞—Ç—å Pull Request –≤ `main`
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω –æ—Ç—á–µ—Ç–∞ (—Å–º. –Ω–∏–∂–µ)
4. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥-—Ä–µ–≤—å—é

---

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Ç—á—ë—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```markdown
# [COPILOT-REPORT] Backend Security Phase 0

**–î–∞—Ç–∞:** <–¥–∞—Ç–∞>  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** <–∏–º—è>  
**–í–µ—Ç–∫–∞:** feature/backend-security-phase0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ / ‚ö†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ / ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### B0.1: CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/src/app.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ó–∞–º–µ–Ω–µ–Ω `origin: '*'` –Ω–∞ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –∏–∑ `.env`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CORS
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

### B0.2: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/src/services/uploadService.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME-type —á–µ—Ä–µ–∑ `file-type`
  - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞: 5MB (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è), 100MB (–≤–∏–¥–µ–æ)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

### B0.3: Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/src/config/redis.ts` (–Ω–æ–≤—ã–π)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `ioredis`
  - –°–æ–∑–¥–∞–Ω –∫–ª–∏–µ–Ω—Ç —Å retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ Redis –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

### B0.4: OTP –≤ Redis
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/src/controllers/authController.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –£–±—Ä–∞–Ω–æ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
  - OTP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis —Å TTL 5 –º–∏–Ω—É—Ç
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ OTP –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

### B0.5: JWT —Å–µ–∫—Ä–µ—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/.env`, `backend/.env.example`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω 256-–±–∏—Ç–Ω—ã–π —Å–µ–∫—Ä–µ—Ç
  - –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è refresh —Ç–æ–∫–µ–Ω–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã

### B0.6: Environment variables
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –≤ `backend/src/`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –£–±—Ä–∞–Ω—ã hardcoded IP (`64.226.94.133`)
  - –í—Å–µ URL –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –ù–µ—Ç hardcoded –∑–Ω–∞—á–µ–Ω–∏–π

### B0.7: SSL –ë–î
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–§–∞–π–ª—ã:** `backend/src/config/database.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - `rejectUnauthorized: true`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è –¥–ª—è CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ SSL –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
```bash
npm install ioredis file-type
npm install --save-dev @types/ioredis
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] CORS: –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤: `.exe` —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- [x] Redis: OTP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ —á–∏—Ç–∞–µ—Ç—Å—è
- [x] OTP: –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
- [x] JWT: —Ç–æ–∫–µ–Ω—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å –Ω–æ–≤—ã–º —Å–µ–∫—Ä–µ—Ç–æ–º
- [x] SSL –ë–î: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

### –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
```bash
npm test
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: <–≤—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã>

---

## üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã/–õ–æ–≥–∏

<–í—Å—Ç–∞–≤–∏—Ç—å –≤–∞–∂–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–ª–∏ –ª–æ–≥–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ>

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ –≤–æ–ø—Ä–æ—Å—ã

<–ï—Å–ª–∏ –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –æ–ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å>

---

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –ö–æ–¥-—Ä–µ–≤—å—é
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ QA
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ staging
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

---

## üîó –°—Å—ã–ª–∫–∏

- Pull Request: #<–Ω–æ–º–µ—Ä PR>
- –°–≤—è–∑–∞–Ω–Ω—ã–µ issues: #<–µ—Å–ª–∏ –µ—Å—Ç—å>
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [Master Action Plan](/audit_reports/master_action_plan.md)

---

**–ü–æ–¥–ø–∏—Å—å:** <–≤–∞—à–µ –∏–º—è>  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** <–¥–∞—Ç–∞>
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 0

–§–∞–∑–∞ 0 —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π, –∫–æ–≥–¥–∞:

- [x] B0.1: CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- [x] B0.2: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ MIME-type —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] B0.3: Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] B0.4: OTP —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis —Å TTL
- [x] B0.5: JWT —Å–µ–∫—Ä–µ—Ç –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏–π (256 bit)
- [x] B0.6: –í—Å–µ IP –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] B0.7: SSL –ë–î —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- [x] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- [x] `.env.example` –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ –≤—Å–µ–º–∏ –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- [x] –ö–æ–¥-—Ä–µ–≤—å—é –ø—Ä–æ–π–¥–µ–Ω–æ
- [x] –û—Ç—á–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω

---

## üîí –ü–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–í–ê–ñ–ù–û:**
- ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` —Ñ–∞–π–ª –≤ Git
- ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å `.gitignore` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–º–æ—â—å

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å [Master Action Plan](/audit_reports/master_action_plan.md)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å [Audit Report](/audit_reports/audit_report.md)
3. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ –≤ Slack/Telegram

---

## üîÑ –¢–æ—á–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Front-end/Mobile

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Backend Phase 0, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π Front-end/Mobile:

| Backend –∑–∞–¥–∞—á–∞ | –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç Front-end/Mobile | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è |
|----------------|------------------------------|---------------|
| B0.1 (CORS) | –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã | –ü–æ—Å–ª–µ B0.1 |
| B0.6 (API URL) | Frontend –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π `API_BASE_URL` (HTTPS) | –ü–æ—Å–ª–µ B0.6 |
| B0.5 (JWT) | Frontend –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã | –ü–æ—Å–ª–µ B0.5 |

**–í—Å—Ç—Ä–µ—á–∞ –∫–æ–º–∞–Ω–¥:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–µ–∏—Ö –§–∞–∑ 0 (Backend + Frontend/Mobile)

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** –Ø–Ω–≤–∞—Ä—å 2026  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** <–¥–∞—Ç–∞>  
**–í–µ—Ä—Å–∏—è:** 1.0
